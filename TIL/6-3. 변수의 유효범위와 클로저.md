https://ko.javascript.info/closure

# 변수의 유효범위와 클로저

## 코드 블록
- 코드 블록 `{...}`안에서 선언한 변수는 블록 안에서만 사용 할 수 있음.
- `if`, `for`, `while`등에서도 마찬가지로 코드블록 안에서 선언한 변수는 오직 블록 안에서만 접근 가능


## 중첩 함수
함수 내부에서 선언한 함수를 '중첩(nested)'함수라고 부름. 

코드 정돈하는데 사용 가능


# !렉시컬 환경!
## 단계 1. 변수
자바스크립트에선 실행중인 함수, 코드 블록 `{...}``, 스크립트 전체는 렉시컬 환경(Lexical Encironment)라 불리는 내무 숨김 연관 객채(internal hidden associated object)를 갖음.

렉시컬 환경의 객체는 두 부분으로 구성됨
- 1. 환경레코드(Environment record): 모든 지역 변수를 프로퍼티로 저장하고 있는 객체. `this`값과 같은 기타 정보도 여기에 저장됨.
- 2. 외부 렉시컬 환경(Outer Lexical Invironment)에 대한 참조: 외부 코드와 연관됨

**`변수`는 특수 내부 객체인 `환경 레코드`의 프로퍼티일 뿐입니다. '변수를 가져오거나 변경'하는 것은 '환경 레코드로의 프로퍼티를 가져오거나 변경'함을 의미함.**

- 변수는 특수 내부 객체인 환경 레코드의 프로퍼티. 환경 레코드는 현재 실행중인 함수와 코드 블록, 스크립트와 연관되어 있음.
- 변수를 변경하면 환경 레코드의 프로퍼티가 변경됨.

## 단계 2. 함수 선언문
함수는 변수와 마찬가지로 값임.

**다만 함수 선언문(function declaration)으로 선언한 함수는 일반 변수와 달리 바로 초기화 됨.**

함수 선언문으로 선언한 함수는 렉시컬 환경이 만들어지는 즉시 사용 가능. 변수는 `let`을 만나 선언 될 때까지 사용 할수 없지만요.

`let say = function(name)...`같이 함수를 변수에 할당한 함수 표현식은 해당하지 않습니다.

## 단계 3. 내부와 외부 렉시컬 환경

함수를 호출하면 호출할 때 마다 새로운 렉시컬 환경 객체가 만들어지고 여기엔 함수를 실행하는데 필요한 변수들이 저장됨.

이 렉시컬 환경엔 함수 호출 시 넘겨받은 매개변수와 함수의 지역 변수가 저장됨.

내부 렉시컬 환경은 외부 렉시컬 환경에 대한 참조를 갖습니다.

**코드에서 변수에 접근할 땐, 먼저 내부 렉시컬 환경을 검색 범위로 잡습니다. 내부 렉시컬 환경에서 원하는 변수를 찾지 못하면 검색범위를 내부 렉시컬 환경이 참조하는 외부 렉시컬 환경으로 확장합니다.**
**이 과정은 검색 범위가 전역 렉시컬 환경이 될 때 까지 반복합니다.**

## 단계 4. 반환 함수
모든 함수는 함수가 생성된 곳의 렉시컬 환경을 기억함. 

함수는 `[[Environment]]`라 불리는 숨김 프로퍼티를 갖는데, 이곳에 함수가 만들어진 곳의 렉시컬 환경에 대한 참조가 저장됨.

함수가 생성될 때 딱 한번 그 값이 세팅되고 영원히 변하지 않음.

**변숫값 갱신은 변수가 저장된 렉시컬 환경에서 이뤄짐.**


