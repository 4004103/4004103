https://ko.javascript.info/weakmap-weakset

---
- 자바스크립트 메모리관리는 가비지 컬렉터(GC)라고 불리는 애가 사용하지 않는 힙 자원을 치워서 메모리를 확보하는데 "사용하지 않는 자원"이 무엇인지 판정하는 기준이
어딘가에서 참조하고있는 값인지 아닌지로 알아냄. 
- Map같은 경우엔 키와 값을 주면 Map에 추가가 되서 아무곳에서도 참조하지않아도 Map이 사용중이기 때문에 GC가 치우지 않음.

- 하지만 weakMap은 등록해둔 값이라고 해도 다른곳에서 참조하고있지 않으면 GC가 치워버림. 그래서 몇몇 특수한 용도로 사용함.

- 당장 key로 사용하는 object가 언제 GC가 치워버릴지 모르는 상황이라면 함수가 실행되면서 lexical scope라는걸 만들어서 이 함수 안에서만 쓰이는 지역변수도 등록이 되는데 함수 실행이 끝나면 지역변수가 
쓸모 없어지기때문에 GC가 치워감. 

- GC가 치워갈 오브젝트를 위크맵에 *키로 등록해두면 나중에 위크맵으로 만들어 둔 연결고리도 알아서 해제됨.
---

# 위크맵과 위크셋
자료구조를 구성하는 요소도 자신이 속한 자료구조가 메모리에 남아있는 동안 대개 도달 가능한 값으로 취급되어 메모리에서 삭제되지 않음. 객체의 프로퍼티나 배열의 요소, 맵이나 셋을 구성하는 요소들이 이에 해당되는데
위크맵은 전혀 다른 양상을 보임.

## 위크맵
맵과 위크맵의 첫번째 차이는 위크맵의 키가 반드시 **객체**여야 한다는 점! 원시값은 위크맵의 키가 될 수 없음
```javascript
let weakMap = new weakMap();

let obj = {};
weakMap.set(obj, "ok"); // 정상적으로 동작함. (객체 키)

// 문자열 "test"는 위크맵의 키로 사용 할 수 없음!
weakMap.set("test","Whoops"); // Error


// 위크맵의 키로 사용된 객체를 참조하는 것이 없다면 메모리와 위크맵에서 자동으로 삭제됨.
let john = {name:john};

let weakMap = new WeakMap();
weakMap.set(john, "...")

john = null; // 참조를 덮어 씀

// john을 나타내는 객체는 메모리에서 지워짐!!!!
```

맵과 위크맵의 두번째 차이는 위크맵은 반복작업과 `keys()`, `value()`, `entries()` 메서드를 지원하지않음. 따라서 위크맵은 키나 값 전체를 얻는게 불가능함.
**위크맵이 지원하는 메서드**
- weakMap.get(key)
- weakMap.set(key, value)
- weakMap.delete(key)
- weakMap.has(key)


## 유스케이스: 추가 데이터
위크맵은 부차적인 데이터를 저장할 곳이 필요할때 진가를 발휘~~

서드파티 라이브러리와 같이 외부코드에 속한 객체를 가지고 작업 한다고 가정하고 이 객체에 데이터를 추가해줘야 하는데 추가해줄 데이터는 객체가 살아있는 동안에만 유효한 상황에 위크맵을 사용.
위크맵에 원하는 데이터를 저장하고 키는 객체를 사용해합니다. 객체가 가비지 컬렉터의 대상이 될 때 데이터도 함께 사라지게 됩니다
```javascript
weakMap.set(john, "비밀문서");
// john이 사망하면 비밀문서는 자동으로 파기됨.
```


## 유스케이스: 캐싱
위크맵은 캐싱이 필요할 때 유용합니다. 캐싱은 시간이 오래 걸리는 작업의 결과를 저장해서 연산 시간과 비용을 절약해주는 기법인데, 동일한 함수를 여러번 호출해야할 할 때, 최초 호출시 반환된 값을
어딘가에 저장해 놓았다가 그 다음엔 함수를 호출하는 대신 저장된 값을 사용하는 게 캐싱의 실례입니다.


# 위크셋
- 위크셋은 셋과 유사한데 객체만 저장할 수 있다는 점이 다름. 원시값 저장X
- 셋 안의 객체는 도달 가능할 때만 메모리에서 유지됨
- 셋과 마찬가지로 워크셋이 지원하는 메서드는 단촐함. `add`, `has`, `delete`를 사용할 수 있고, `size`, `key()`나 반복작업 관련 메서드는 사용 불가

위크맵과 유사하게 위크셋도 부차적인 데이터를 저장할 떄 사용 할 수 있습니다. "예"나 "아니오" 같은 간단한 답변을 얻는 용도로 사용됨.
위크셋에 저장되는 값을은 객체이다.


# 요약 
- 위크맵은 맵과 유사한 컬렉션이고 위크맵을 구성하는 요소의 키는 오직 객체만 가능함. 키로 사용된 객체가 메모리에서 삭제되면 이에 대응하는 값 역시 삭제됨.
- 위크셋은 셋과 유사한 컬렉션이고 위크셋엔 객체만 저장 할 수 있음. 위크셋에 저장된 객체가 도달 불가능한 상태가 되면 해당 객체는 메모리에서 삭제됨.
- 두 자료구조 모두 구성요소 전체를 대상으로 하는 메서드는 지원하지 않고 하나를 대상으로 하는 메서드만 지원함.
- 객체엔 '주요'자료를, 위크맵과 위크셋엔 '부수적인'자료를 저장하는 형태로 활용가능. 객체가 메모리에서 삭제되면 (그리고 오로지 위크맵과 위크셋의 키만 해당 객체를 참조하고 있다면)
위크맵이나 위크셋에 저장된 연관 자료들은 메모리에서 자동으로 삭제됨.










